---
title: "Lomatium bradshawii"
author: "Elizabeth Hiroyasu"
date: "Tuesday, May 19, 2015"
output: html_document
---

This analysis explores the use of the demographic trend package for the species Lomatium bradshawii, Bradshaw's desert parsley. This is an endangered, herbaceous perennial that occurs in Oregon and Washington. Primary threats to L. bradshawii are habitat loss. To download the matrix population data for this species, visit the compadre website at 
http://www.compadre-db.org.

# Data loading
## Load in the Compadre data and take the default selection
The data file needs to be in the working directory. It can be downloaded from http://www.compadre-db.org.

```{r}
library(DemographicTrend)
CompadreFile <- "COMPADRE_10_11_2014_version_3.0.Rdata"
mydata <- Load_Compadre_Data(CompadreFile)
```

## Subset the data to the focal species
```{r}
LoBr<-subset(mydata$metadata, SpeciesAuthor=="Lomatium_bradshawii")

#pulling out LoBr Matrices
save<-as.numeric(rownames(LoBr))
LoBrMat<- as.array(mydata$mat[save])
LoBrMat <- as.array(mydata$mat[mydata$metadata$SpeciesAuthor=="Lomatium_bradshawii"])
```

## Pull out the matrices
```{r}
##pulling out LoBr survival matrices
surv_mat<-array(1, dim=c(dim(LoBrMat[[1]]$matU)[1], dim(LoBrMat[[1]]$matU)[2], dim(LoBrMat)))
for (i in 1:dim(LoBrMat)){
  surv_mat[,,i]<-LoBrMat[[i]]$matU
}

##pulling out LoBr reproduction
fert_mat<-array(1, dim=c(dim(LoBrMat[[1]]$matF)[1], dim(LoBrMat[[1]]$matF)[2], dim(LoBrMat)))
for (i in 1:dim(LoBrMat)){
  fert_mat[,,i]<-LoBrMat[[i]]$matF
}

##pulling out LoBr transition matrices
trans_mat<-array(1, dim=c(dim(LoBrMat[[1]]$matA)[1], dim(LoBrMat[[1]]$matA)[2], dim(LoBrMat)))
for (i in 1:dim(LoBrMat)){
  trans_mat[,,i]<-LoBrMat[[i]]$matA
}
```

# Analysis
Unlike the Cirsium pitcheri example we worked on previously, we will not be using observed population vectors. Instead we will generate N0 vectors from the transition matrices using the DemographicTrend package:

```{r, gen_N0}
years<-1:dim(surv_mat)[3]
N0_data<-gen_N0(trans_mat)
```

To introduce simulations to compare p-values using the functions in the Demographic Trend Package. For this exercise we have introduced the trend in stage four of the matrix survival data.
```{r}
return_pv<-replicate(5, trend_sim())
```
This code can be adjusted to increase the number of replications and returns a list of p-values for the survival and abundance regressions.
