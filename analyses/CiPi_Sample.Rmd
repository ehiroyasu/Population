---
title: "CiPi_Analysis"
author: "Elizabeth Hiroyasu"
date: "Wednesday, May 06, 2015"
output: html_document
---

This is a sample analysis using the demographic trend package for a population of Cirsium pitcheri.

# Data loading
## Load in the Compadre data and take the default selection
The data file needs to be in the working directory. It can be downloaded from http://www.compadre-db.org.


```{r}
library(DemographicTrend)
CompadreFile <- "COMPADRE_10_11_2014_version_3.0.Rdata"
mydata <- Load_Compadre_Data(CompadreFile)
```


## Subset the data to the focal species
```{r}
CiPi<-subset(mydata$metadata, Population=="CiPi 1")

#pulling out LoBr Matrices
save<-as.numeric(rownames(CiPi))
CiPiMat<- as.array(mydata$mat[save])
CiPiMat <- as.array(mydata$mat[mydata$metadata$Population=="CiPi 1"])
```


## Pull out the matrices
```{r}
##pulling out LoBr survival matrices
surv_mat<-array(1, dim=c(dim(CiPiMat[[1]]$matU)[1], dim(CiPiMat[[1]]$matU)[2], dim(CiPiMat)))
for (i in 1:dim(CiPiMat)){
  surv_mat[,,i]<-CiPiMat[[i]]$matU
}

##pulling out LoBr reproduction
fert_mat<-array(1, dim=c(dim(CiPiMat[[1]]$matF)[1], dim(CiPiMat[[1]]$matF)[2], dim(CiPiMat)))
for (i in 1:dim(CiPiMat)){
  fert_mat[,,i]<-CiPiMat[[i]]$matF
}

##pulling out LoBr transition matrices
trans_mat<-array(1, dim=c(dim(CiPiMat[[1]]$matA)[1], dim(CiPiMat[[1]]$matA)[2], dim(CiPiMat)))
for (i in 1:dim(CiPiMat)){
  trans_mat[,,i]<-CiPiMat[[i]]$matA
}
```


##Loading the N0 vectors:
##subsetting the data for cipi data
N0_data <- load_N0()
cipi_nx<- subset(N0_data, POP =="CIPI_1")
nx_str<- cipi_nx$Nx
years <- 1:length(cipi_nx$YR)
N0_data<-nx_out(nx_str)

To introduce simulations to compare p-values using the functions in the Demographic Trend Package:
```{r}
return_pv<-replicate(10, trend_sim())
```
This code can be adjusted to increase the number of replications and returns a list of p-values for the survival and abundance regressions.