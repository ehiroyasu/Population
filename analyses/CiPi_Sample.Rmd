---
title: "CiPi_Analysis"
author: "Elizabeth Hiroyasu"
date: "Wednesday, May 06, 2015"
output: html_document
---

This is a sample analysis using the demographic trend package for a population of Cirsium pitcheri.

# Data loading
## Load in the Compadre data and take the default selection
The data file needs to be in the working directory. It can be downloaded from http://www.compadre-db.org.


```{r}
library(DemographicTrend)
CompadreFile <- "COMPADRE_10_11_2014_version_3.0.Rdata"
mydata <- Load_Compadre_Data(CompadreFile)
```


## Subset the data to the focal species
```{r}
CiPi<-subset(mydata$metadata, Population=="CiPi 1")

#pulling out CiPi Matrices
save<-as.numeric(rownames(CiPi))
MatrixData<- as.array(mydata$mat[save])
MatrixData<- as.array(mydata$mat[mydata$metadata$Population=="CiPi 1"])
```


## Pull out the matrices
```{r}
##pulling out CiPi survival matrices
surv_mat<-(extract_mat(MatrixData))$"survival matrices"

##pulling out CiPi fertility matrices
fert_mat<-(extract_mat(MatrixData))$"fertility matrices"

##pulling out CiPi transition matrices
trans_mat<-(extract_mat(MatrixData))$"transition matrices"
```

#calculating the number of stages in the matrix:
nstage<-1:dim(surv_rand)[1]

##Loading the N0 vectors:
N0_data <- load_N0()

##subsetting the data for cipi data
cipi_nx<- subset(N0_data, POP =="CIPI_1")
nx_str<- cipi_nx$Nx
N0_data<-output_N0(nx_str)

To introduce simulations to compare p-values using the functions in the Demographic Trend Package:
```{r}
return_pv<-replicate(10, calc_pv(surv_mat, fert_mat, N0_data, nstage, years=1:20, stage2mod=2, beta=0.01))

#single_pv<-calc_pv(surv_mat, fert_mat, N0_data, nstage, years=1:20, stage2mod=2, beta=0.01)
```
This code can be adjusted to increase the number of replications and returns a list of p-values for the survival and abundance regressions.